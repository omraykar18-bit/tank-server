<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Water Tank Control Panel</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
}

h1 {
  text-align: center;
  padding: 20px;
  margin: 0;
}

.dashboard {
  display: flex;
  justify-content: center;
  gap: 80px;
  margin-top: 40px;
}

.tank-wrapper {
  text-align: center;
}

.tank {
  width: 140px;
  height: 350px;
  border: 4px solid #94a3b8;
  border-radius: 10px;
  position: relative;
  overflow: hidden;
  background: #1e293b;
}

.water {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 0%;
  background: linear-gradient(to top, #3b82f6, #60a5fa);
  transition: height 1s ease;
}

.percent {
  margin-top: 10px;
  font-size: 18px;
}

.status-panel {
  margin-top: 60px;
  text-align: center;
}

.badge {
  padding: 10px 20px;
  border-radius: 20px;
  font-weight: bold;
  display: inline-block;
}

.on {
  background: #16a34a;
}

.off {
  background: #dc2626;
}

.info-box {
  margin-top: 20px;
  font-size: 14px;
  color: #cbd5e1;
}
</style>
</head>

<body>

<h1>Water Tank Monitoring System</h1>

<div class="dashboard">

  <div class="tank-wrapper">
    <h3>Top Tank</h3>
    <div class="tank">
      <div id="topWater" class="water"></div>
    </div>
    <div id="topPercent" class="percent">0%</div>
  </div>

  <div class="tank-wrapper">
    <h3>Bottom Tank</h3>
    <div class="tank">
      <div id="bottomWater" class="water"></div>
    </div>
    <div id="bottomPercent" class="percent">0%</div>
  </div>

</div>

<div class="status-panel">
  <div id="motorBadge" class="badge off">Motor OFF</div>
  <div id="lastUpdate" class="info-box">Last update: --</div>
</div>

<script>

function getColor(percent) {
  if (percent < 20) return "#dc2626";
  if (percent < 60) return "#f59e0b";
  return "#16a34a";
}

async function updateData() {
  try {
    const res = await fetch('/api/status');
    const data = await res.json();

    const top = data.top;
    const bottom = data.bottom;

    const topWater = document.getElementById("topWater");
    const bottomWater = document.getElementById("bottomWater");

    topWater.style.height = top + "%";
    bottomWater.style.height = bottom + "%";

    topWater.style.background = getColor(top);
    bottomWater.style.background = getColor(bottom);

    document.getElementById("topPercent").innerText = top + "%";
    document.getElementById("bottomPercent").innerText = bottom + "%";

    const motorBadge = document.getElementById("motorBadge");

    if (data.motor) {
      motorBadge.innerText = "Motor ON";
      motorBadge.className = "badge on";
    } else {
      motorBadge.innerText = "Motor OFF";
      motorBadge.className = "badge off";
    }

    const time = new Date(data.timestamp);
    document.getElementById("lastUpdate").innerText =
      "Last update: " + time.toLocaleTimeString();

  } catch (err) {
    console.log("Fetch error", err);
  }
}

setInterval(updateData, 2000);
updateData();

</script>

</body>
</html>
